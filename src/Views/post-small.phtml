<?php
CustomAssetViewDecorator::addStylesheet('post-small.css');

$classNames =
[
	'post',
	'post-type-' . TextCaseConverter::convert(
		TextHelper::resolveMimeType($this->context->post->mimeType)
			?: PostType::toString($this->context->post->type),
		TextCaseConverter::CAMEL_CASE,
		TextCaseConverter::SPINAL_CASE),
];

$masstag = (isset($this->context->source)
	and $this->context->source == 'mass-tag'
	and !empty($this->context->additionalInfo));

if ($masstag)
{
	$classNames []= 'taggable';
	if ($this->context->post->isTaggedWith($this->context->additionalInfo))
	{
		$classNames []= 'tagged';
	}
}
?>

<div class="<?php echo implode(' ', $classNames) ?>">
	<?php if ($masstag): ?>
		<a class="toggle-tag" href="<?php echo \Chibi\UrlHelper::route('post', 'toggle-tag', ['id' => $this->context->post->id, 'tag' => $this->context->additionalInfo, 'enable' => '_enable_']) ?>" data-text-tagged="Tagged" data-text-untagged="Untagged">
			<?php echo in_array('tagged', $classNames) ? 'Tagged' : 'Untagged' ?>
		</a>
	<?php endif ?>

	<?php if ($this->context->user->hasEnabledPostTagTitles()): ?>
		<a title="<?php echo TextHelper::reprTags($this->context->post->getTags()) ?>" class="link" href="<?php echo \Chibi\UrlHelper::route('post', 'view', ['id' => $this->context->post->id]) ?>">
	<?php else: ?>
		<a class="link" href="<?php echo \Chibi\UrlHelper::route('post', 'view', ['id' => $this->context->post->id]) ?>">
	<?php endif ?>
		<img class="thumb" src="<?php echo \Chibi\UrlHelper::route('post', 'thumb', ['name' => $this->context->post->name]) ?>" alt="@<?php echo $this->context->post->id ?>"/>
		<?php
			$x =
			[
				'score' => $this->context->post->score,
				'comments' => $this->context->post->commentCount,
				'favs' => $this->context->post->favCount,
			];
		?>
		<?php if (!empty($x)): ?>
			<div class="info-bar">
				<?php foreach ($x as $key => $val): ?>
					<?php if ($val == 0): ?>
						<span class="inactive">
					<?php else: ?>
						<span>
					<?php endif ?>
						<i class="icon-<?php echo $key ?>"></i>
						&nbsp;<?php echo $val ?>
					</span>
				<?php endforeach ?>
			</div>
		<?php endif ?>
	</a>
</div>
