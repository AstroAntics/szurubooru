<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<?php if (isset($this->context->subTitle)): ?>
			<title><?php printf('%s&nbsp;&ndash;&nbsp;%s', $this->context->title, $this->context->subTitle) ?></title>
		<?php else: ?>
			<title><?php echo $this->context->title ?></title>
		<?php endif ?>
		<?php foreach ($this->context->stylesheets as $name): ?>
			<link rel="stylesheet" type="text/css" href="<?php echo \Chibi\UrlHelper::absoluteUrl('/media/css/' . $name) ?>" />
		<?php endforeach ?>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	</head>

	<body>
		<nav>
			<div class="main-wrapper">
				<ul>
					<?php
						$preNav = [];
						$postNav = [];

						$preNav []= ['Home', \Chibi\UrlHelper::route('index', 'index')];
						$preNav []= ['Browse', \Chibi\UrlHelper::route('post', 'list')];
						$preNav []= ['Comments', \Chibi\UrlHelper::route('comment', 'list')];
						$preNav []= ['Favorites', \Chibi\UrlHelper::route('post', 'favorites')];
						if (PrivilegesHelper::confirm($this->context->user, Privilege::UploadPost))
							$preNav []= ['Upload', \Chibi\UrlHelper::route('post', 'upload')];

						if (!$this->context->loggedIn)
						{
							$postNav []= ['Login', \Chibi\UrlHelper::route('auth', 'login')];
							$postNav []= ['Register', \Chibi\UrlHelper::route('auth', 'register')];
						}
						else
						{
							$postNav []= ['Account', \Chibi\UrlHelper::route('user', 'show', ['name' => $this->context->user->name])];
							$postNav []= ['Logout', \Chibi\UrlHelper::route('auth', 'logout')];
						}

						function printNav($nav)
						{
							foreach ($nav as $navItem)
							{
								list ($text, $link) = $navItem;
								echo '<li>';
								echo '<a href="' . $link . '">' . $text . '</a>';
								echo '</li>';
							}
						}
					?>

					<?php printNav($preNav); ?>
					<li class="search">
						<form action="<?php echo \Chibi\UrlHelper::route('post', 'list') ?>" method="get">
							<input type="search" name="query" placeholder="search&hellip;" value="<?php if (isset($this->context->searchQuery)) echo $this->context->searchQuery ?>">
						</form>
					</li>
					<?php printNav($postNav); ?>
				</ul>
				<div class="clear"></div>
			</div>
		</nav>

		<section id="content">
			<div class="main-wrapper">
				<?php echo $this->renderView() ?>
			</div>
		</section>
	</body>
</html>
