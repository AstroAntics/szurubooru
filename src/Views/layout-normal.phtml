<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<?php if (isset($this->context->subTitle)): ?>
			<title><?php printf('%s&nbsp;&ndash;&nbsp;%s', $this->context->title, $this->context->subTitle) ?></title>
		<?php else: ?>
			<title><?php echo $this->context->title ?></title>
		<?php endif ?>
		<?php foreach ($this->context->stylesheets as $name): ?>
			<link rel="stylesheet" type="text/css" href="<?php echo \Chibi\UrlHelper::absoluteUrl('/media/css/' . $name) ?>"/>
		<?php endforeach ?>
		<?php foreach ($this->context->scripts as $name): ?>
			<script type="text/javascript" src="<?php echo \Chibi\UrlHelper::absoluteUrl('/media/js/' . $name) ?>"></script>
		<?php endforeach ?>
	</head>

	<body>
		<nav id="top-nav">
			<div class="main-wrapper">
				<ul>
					<?php
						$nav = [];

						$nav []= ['Home', \Chibi\UrlHelper::route('index', 'index')];
						if (PrivilegesHelper::confirm($this->context->user, Privilege::ListPosts))
							$nav []= ['Browse', \Chibi\UrlHelper::route('post', 'list')];

						if (PrivilegesHelper::confirm($this->context->user, Privilege::ListComments))
							$nav []= ['Comments', \Chibi\UrlHelper::route('comment', 'list')];

						if (PrivilegesHelper::confirm($this->context->user, Privilege::ListPosts))
							$nav []= ['Favorites', \Chibi\UrlHelper::route('post', 'favorites')];

						if (PrivilegesHelper::confirm($this->context->user, Privilege::ListTags))
							$nav []= ['Tags', \Chibi\UrlHelper::route('tag', 'list')];

						if (PrivilegesHelper::confirm($this->context->user, Privilege::UploadPost))
							$nav []= ['Upload', \Chibi\UrlHelper::route('post', 'upload')];

						if (PrivilegesHelper::confirm($this->context->user, Privilege::ListUsers))
							$nav []= ['Users', \Chibi\UrlHelper::route('user', 'list')];

						if (!$this->context->loggedIn)
						{
							$nav []= ['Log in', \Chibi\UrlHelper::route('auth', 'login')];
							$nav []= ['Register', \Chibi\UrlHelper::route('auth', 'register')];
						}
						else
						{
							$nav []= ['My account', \Chibi\UrlHelper::route('user', 'show', ['name' => $this->context->user->name])];
							$nav []= ['Log out', \Chibi\UrlHelper::route('auth', 'logout')];
						}

						$nav []= ['Help', \Chibi\UrlHelper::route('index', 'help')];

						foreach ($nav as $navItem)
						{
							list ($text, $link) = $navItem;
							echo '<li>';
							echo '<a href="' . $link . '">' . $text . '</a>';
							echo '</li>';
						}
					?>
				</ul>
				<div class="clear"></div>
			</div>
		</nav>

		<section id="content">
			<div class="main-wrapper">
				<?php echo $this->renderView() ?>
			</div>
		</section>
	</body>
</html>
