<nav class="sort-styles">
	<ul>
		<?php
		$sortStyles =
		[
			'order:alpha,asc' => 'Sort A&rarr;Z',
			'order:alpha,desc' => 'Sort Z&rarr;A',
			'order:popularity,desc' => 'Often used first',
			'order:popularity,asc' => 'Rarely used first',
		];

		if ($this->config->registration->staffActivation)
			$sortStyles['pending'] = 'Pending staff review';
		?>

		<?php foreach ($sortStyles as $key => $text): ?>
			<?php if ($this->context->filter == $key): ?>
				<li class="active">
			<?php else: ?>
				<li>
			<?php endif ?>
				<a href="<?php echo \Chibi\UrlHelper::route('tag', 'list', ['filter' => $key]) ?>"><?php echo $text ?></a>
			</li>
		<?php endforeach ?>
	</ul>
</nav>

<?php if (empty($this->context->transport->tags)): ?>
	<p class="alert alert-warning">No tags to show.</p>
<?php else: ?>
	<?php $max = max([0]+array_map(function($x) { return $x['post_count']; }, $this->context->transport->tags)); ?>
	<?php $add = 0. ?>
	<?php $mul = 10. / max(1, log(max(1, $max))) ?>
	<?php $url = \Chibi\UrlHelper::route('post', 'list', ['query' => '_query_']) ?>
	<div class="tags">
		<ul>
			<?php foreach ($this->context->transport->tags as $tag): ?>
				<?php $name = $tag['name'] ?>
				<?php $count = $tag['post_count'] ?>
				<li class="tag" title="<?php echo $name ?> (<?php echo $count ?>)">
					<a href="<?php echo str_replace('_query_', $name, $url) ?>" class="frequency<?php printf('%1.0f', $add + $mul * log($count)) ?>">
						<?php echo $name . ' (' . $count . ')' ?>
					</a>
				</li>
			<?php endforeach ?>
		</ul>
	</div>
<?php endif ?>
