<?php
CustomAssetViewDecorator::setSubTitle('users');
CustomAssetViewDecorator::addStylesheet('user-list.css');
CustomAssetViewDecorator::addStylesheet('paginator.css');
if ($this->context->user->hasEnabledEndlessScrolling())
	CustomAssetViewDecorator::addScript('paginator-endless.js');
?>

<nav class="sort-styles">
	<ul>
		<?php
		$filters =
		[
			'order:alpha,asc' => 'Sort A&rarr;Z',
			'order:alpha,desc' => 'Sort Z&rarr;A',
			'order:date,asc' => 'Sort old&rarr;new',
			'order:date,desc' => 'Sort new&rarr;old',
		];

		if ($this->config->registration->staffActivation)
			$filters['pending'] = 'Pending staff review';
		?>

		<?php foreach ($filters as $key => $text): ?>
			<?php if ($this->context->filter == $key): ?>
				<li class="active">
			<?php else: ?>
				<li>
			<?php endif ?>
				<a href="<?= \Chibi\UrlHelper::route('user', 'list', ['filter' => $key]) ?>"><?= $text ?></a>
			</li>
		<?php endforeach ?>
	</ul>
</nav>

<?php if (empty($this->context->transport->users)): ?>
	<p class="alert alert-warning">No users to show.</p>
<?php else: ?>
	<div class="users-wrapper">
		<div class="users paginator-content">
			<?php foreach ($this->context->transport->users as $user): ?>
				<div class="user">
					<a class="avatar" href="<?= \Chibi\UrlHelper::route('user', 'view', ['name' => $user->name]) ?>">
						<img src="<?= htmlspecialchars($user->getAvatarUrl(100)) ?>" alt="<?= $user->name ?>"/>
					</a>
					<div class="details">
						<h1>
							<a href="<?= \Chibi\UrlHelper::route('user', 'view', ['name' => $user->name]) ?>">
								<?= $user->name ?>
							</a>
						</h1>

						<div class="date-registered" title="<?= TextHelper::formatDate($user->joinDate, true) ?>">
							Registered: <?= TextHelper::formatDate($user->joinDate, false) ?>
						</div>

						<div class="post-count">
							Uploaded: <?= TextHelper::useDecimalUnits($user->getPostCount()) ?>
						</div>

						<div class="fav-count">
							Favorites: <?= TextHelper::useDecimalUnits($user->getFavoriteCount()) ?>
						</div>
					</div>
				</div>
			<?php endforeach ?>
		</div>
		<div class="clear"></div>
	</div>

	<?php $this->renderFile('paginator') ?>
<?php endif ?>
